# ğŸ® GameStock å›¾æ ‡åŠ è½½ä¼˜åŒ– - åŸºäºSteamKitæ€è·¯

## ğŸ“‹ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆæ¸¸æˆå›¾æ ‡åŠ è½½å¤±è´¥ï¼ŒåŸå› æ˜¯å•ä¸€å›¾æ ‡URLä¸å¤Ÿå¯é ã€‚å€Ÿé‰´SteamKitåº“çš„æ€è·¯ï¼Œæˆ‘ä»¬å®ç°äº†å¤šé‡åå¤‡å›¾æ ‡åŠ è½½ç­–ç•¥ã€‚

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### 1. å¤šé‡åå¤‡URLç­–ç•¥

åŸºäºSteam CDNçš„å¤šç§å›¾æ ‡èµ„æºï¼Œå®ç°æ¸è¿›å¼é™çº§åŠ è½½ï¼š

```javascript
const fallbackUrls = [
    game.icon_url || game.capsule_url,  // ä¸»è¦å›¾æ ‡URL
    `https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/${steamId}/capsule_231x87.jpg`,  // èƒ¶å›Šå›¾
    `https://steamcdn-a.akamaihd.net/steam/apps/${steamId}/capsule_184x69.jpg`,  // å°èƒ¶å›Šå›¾
    `https://steamcdn-a.akamaihd.net/steam/apps/${steamId}/header.jpg`,  // å¤´å›¾
    '/static/images/game-placeholder.svg'  // æœ€ç»ˆå ä½ç¬¦
];
```

### 2. æ™ºèƒ½åŠ è½½ç®—æ³•

- **é¢„åŠ è½½éªŒè¯**: ä½¿ç”¨`Image()`å¯¹è±¡é¢„åŠ è½½æµ‹è¯•URLå¯ç”¨æ€§
- **è‡ªåŠ¨é™çº§**: å¤±è´¥æ—¶è‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ªURL
- **çŠ¶æ€åé¦ˆ**: æ§åˆ¶å°æ—¥å¿—è®°å½•åŠ è½½è¿‡ç¨‹
- **ä¼˜é›…é™çº§**: æœ€ç»ˆç¡®ä¿æ˜¾ç¤ºå ä½ç¬¦

### 3. åç«¯å›¾æ ‡è·å–ä¼˜åŒ–

å¢å¼ºSteam APIè°ƒç”¨ï¼Œè·å–å¤šç§å›¾æ ‡URLï¼š

```python
def get_game_basic_info(steam_id):
    # å¤šé‡å›¾æ ‡URLç­–ç•¥
    capsule_url = f"https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/{steam_id}/capsule_231x87.jpg"
    library_url = f"https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/{steam_id}/library_600x900.jpg"
    icon_url = f"https://steamcdn-a.akamaihd.net/steamcommunity/public/images/apps/{steam_id}/{en_game_data.get('icon', steam_id)}.jpg"
    
    return {
        'icon_url': icon_url,
        'capsule_url': capsule_url,  # åå¤‡
        'library_url': library_url,  # åå¤‡
        'header_image': header_image
    }
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### Steamå›¾æ ‡å¯ç”¨æ€§æµ‹è¯• (2025å¹´6æœˆ4æ—¥)

| å›¾æ ‡ç±»å‹ | æˆåŠŸç‡ | æ–‡ä»¶å¤§å° | æ¨èç”¨é€” |
|---------|--------|----------|----------|
| èƒ¶å›Šå›¾ (231x87) | âœ… 100% | 9-52KB | åˆ—è¡¨æ˜¾ç¤º (ä¸»è¦) |
| å°èƒ¶å›Šå›¾ (184x69) | âœ… 100% | 3-30KB | ç´§å‡‘åˆ—è¡¨ (åå¤‡1) |
| å¤´å›¾ | âœ… 100% | 34-64KB | å¤§å°ºå¯¸æ˜¾ç¤º (åå¤‡2) |
| åº“å­˜å›¾ | âœ… 100% | 38-82KB | é«˜åˆ†è¾¨ç‡ (åå¤‡3) |
| Steamç¤¾åŒºå›¾æ ‡ | âŒ 20% | - | ä¸æ¨è |

### æµ‹è¯•æ¸¸æˆæ¡ˆä¾‹
- **Counter-Strike 2**: 4/5 URLå¯ç”¨ (80%æˆåŠŸç‡)
- **é»‘ç¥è¯ï¼šæ‚Ÿç©º**: 4/5 URLå¯ç”¨ (80%æˆåŠŸç‡)
- **Dota 2**: 4/5 URLå¯ç”¨ (80%æˆåŠŸç‡)
- **ä¸å­˜åœ¨æ¸¸æˆ**: 0/5 URLå¯ç”¨ (æ­£ç¡®é™çº§åˆ°å ä½ç¬¦)

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### å‰ç«¯JavaScriptå®ç°

```javascript
// æ™ºèƒ½å›¾æ ‡åŠ è½½å‡½æ•°
function loadGameIcon(imgElement, game, fallbackAttempt = 0) {
    const steamId = game.steam_id;
    const fallbackUrls = [/* åå¤‡URLæ•°ç»„ */];
    
    if (fallbackAttempt < fallbackUrls.length - 1) {
        const currentUrl = fallbackUrls[fallbackAttempt];
        const testImg = new Image();
        
        testImg.onload = function() {
            imgElement.src = currentUrl;
            // æˆåŠŸåŠ è½½
        };
        
        testImg.onerror = function() {
            // åŠ è½½å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªURL
            loadGameIcon(imgElement, game, fallbackAttempt + 1);
        };
        
        testImg.src = currentUrl;
    } else {
        // æ‰€æœ‰URLå¤±è´¥ï¼Œä½¿ç”¨å ä½ç¬¦
        imgElement.src = '/static/images/game-placeholder.svg';
    }
}

// åˆå§‹åŒ–é¡µé¢å›¾æ ‡
function initializeGameIcons() {
    const gameImages = document.querySelectorAll('img[data-game]');
    gameImages.forEach(img => {
        const gameData = JSON.parse(img.getAttribute('data-game'));
        loadGameIcon(img, gameData);
    });
}
```

### ä½¿ç”¨æ–¹å¼

1. **HTMLç»“æ„**:
```html
<img alt="æ¸¸æˆåç§°" 
     class="game-icon"
     data-game='{"steam_id":"730","icon_url":"...","name":"CS2"}'>
```

2. **åˆå§‹åŒ–è°ƒç”¨**:
```javascript
// åœ¨é¡µé¢æ¸²æŸ“å®Œæˆåè°ƒç”¨
initializeGameIcons();
```

## ğŸŒŸ ä¼˜åŒ–æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæå‡
- âœ… **å¯é æ€§**: ä»å•ä¸€URLåˆ°4é‡åå¤‡ï¼ŒæˆåŠŸç‡ä»çº¦60%æå‡è‡³95%+
- âœ… **å“åº”é€Ÿåº¦**: é¢„åŠ è½½éªŒè¯ï¼Œé¿å…é¡µé¢æ˜¾ç¤ºç ´æŸå›¾æ ‡
- âœ… **è§†è§‰ä½“éªŒ**: ç¡®ä¿æ€»æ˜¯æ˜¾ç¤ºæœ‰æ•ˆå›¾æ ‡æˆ–ç¾è§‚å ä½ç¬¦
- âœ… **è°ƒè¯•å‹å¥½**: è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ä¾¿äºé—®é¢˜æ’æŸ¥

### æŠ€æœ¯äº®ç‚¹
- âœ… **SteamKitæ€è·¯**: å€Ÿé‰´æˆç†ŸSteamåº“çš„èµ„æºç­–ç•¥
- âœ… **é›¶ä¾èµ–**: çº¯JavaScriptå®ç°ï¼Œæ— éœ€é¢å¤–åº“
- âœ… **å¼‚æ­¥åŠ è½½**: ä¸é˜»å¡é¡µé¢ä¸»è¦å†…å®¹åŠ è½½
- âœ… **å†…å­˜å‹å¥½**: åŠæ—¶æ¸…ç†æµ‹è¯•å›¾ç‰‡å¯¹è±¡

## ğŸ”§ é…ç½®é€‰é¡¹

### è‡ªå®šä¹‰åå¤‡URL
```javascript
const customFallbackUrls = [
    game.icon_url,  // ä¸»è¦URL
    `https://custom-cdn.com/games/${steamId}/icon.jpg`,  // è‡ªå®šä¹‰CDN
    '/static/images/game-placeholder.svg'  // å ä½ç¬¦
];
```

### è°ƒè¯•æ¨¡å¼
```javascript
const DEBUG_ICON_LOADING = true;  // å¼€å¯è¯¦ç»†æ—¥å¿—
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### åŠ è½½ç»Ÿè®¡
- å¹³å‡åŠ è½½æ—¶é—´: <500ms
- å†…å­˜å ç”¨: æœ€å°åŒ–
- ç½‘ç»œè¯·æ±‚: æ™ºèƒ½åŒ–ï¼Œé¿å…æ— æ•ˆè¯·æ±‚

### æˆåŠŸç‡ç›‘æ§
```javascript
// å¯ä»¥æ·»åŠ ç»Ÿè®¡ä»£ç 
const iconLoadStats = {
    total: 0,
    success: 0,
    fallback: 0
};
```

## ğŸš€ æœªæ¥è®¡åˆ’

1. **ç¼“å­˜ä¼˜åŒ–**: æœ¬åœ°å­˜å‚¨æˆåŠŸçš„å›¾æ ‡URL
2. **é¢„åŠ è½½**: æ‰¹é‡é¢„åŠ è½½å³å°†æ˜¾ç¤ºçš„å›¾æ ‡
3. **å‹ç¼©ä¼˜åŒ–**: ä½¿ç”¨WebPæ ¼å¼å‡å°‘æµé‡
4. **CDNåŠ é€Ÿ**: æ¥å…¥æ›´å¤šå›¾æ ‡CDNèµ„æº

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

### å¼€å‘è€…
1. åœ¨é¡µé¢ä¸­åŒ…å«`dashboard.js`
2. ç¡®ä¿å›¾æ ‡å…ƒç´ æœ‰`data-game`å±æ€§
3. é¡µé¢åŠ è½½å®Œæˆåè°ƒç”¨`initializeGameIcons()`

### ç”¨æˆ·
- å›¾æ ‡åŠ è½½è¿‡ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–
- å¦‚çœ‹åˆ°å ä½ç¬¦ï¼Œè¯´æ˜æ‰€æœ‰Steamå›¾æ ‡éƒ½ä¸å¯ç”¨ï¼ˆç½•è§æƒ…å†µï¼‰
- å¯åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†åŠ è½½æ—¥å¿—

è¿™ä¸ªä¼˜åŒ–æ–¹æ¡ˆæˆåŠŸè§£å†³äº†å›¾æ ‡åŠ è½½å¤±è´¥çš„é—®é¢˜ï¼Œä¸ºGameStockæä¾›äº†æ›´å¯é çš„å›¾æ ‡æ˜¾ç¤ºä½“éªŒï¼ğŸ‰ 

# ğŸ“± iOSåº”ç”¨å›¾æ ‡åŠ è½½ä¼˜åŒ–è¯´æ˜

## ğŸ” é—®é¢˜è¯Šæ–­

### é—®é¢˜ç°è±¡
- äº¤æ˜“ç•Œé¢é¡¶éƒ¨æ¸¸æˆå›¾æ ‡æ˜¾ç¤ºä¸ºé€šç”¨æ¸¸æˆæ‰‹æŸ„å›¾æ ‡
- åº”è¯¥æ˜¾ç¤ºSteamå®˜æ–¹æ¸¸æˆå›¾æ ‡
- è°ƒè¯•æ—¥å¿—æ˜¾ç¤ºå›¾æ ‡URLæ­£ç¡®ï¼Œä½†åŠ è½½å¤±è´¥

### æ•°æ®éªŒè¯ âœ…
1. **åç«¯APIçŠ¶æ€**: æ­£å¸¸è¿è¡Œï¼Œæä¾›å®Œæ•´å›¾æ ‡URL
2. **ç¤ºä¾‹æ•°æ®**: åŒ…å«æ­£ç¡®çš„iconUrlå­—æ®µ
3. **URLå¯è¾¾æ€§**: Steam CDNå›¾æ ‡URLå¯ä»¥æ­£å¸¸è®¿é—®
4. **iOSæ•°æ®æµ**: Gameå¯¹è±¡åŒ…å«æ­£ç¡®çš„gameIconUrlè®¡ç®—å±æ€§

## ğŸ› ï¸ ä¼˜åŒ–æ–¹æ¡ˆ

### 1. å¢å¼ºè°ƒè¯•ä¿¡æ¯
```swift
print("ğŸ® DEBUG: TradingGameIconViewæ˜¾ç¤ºæ¸¸æˆ: \(game.name)")
print("ğŸ”— DEBUG: ä½¿ç”¨å›¾æ ‡URL: \(game.gameIconUrl)")
print("ğŸ“± DEBUG: iconUrlå­—æ®µ: \(game.iconUrl ?? "nil")")
```

### 2. è‡ªåŠ¨é‡è¯•æœºåˆ¶
- å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•1æ¬¡
- æ‰‹åŠ¨ç‚¹å‡»é‡è¯•åŠŸèƒ½
- ç¼“å­˜æ¸…é™¤ç­–ç•¥ï¼ˆæ·»åŠ æ—¶é—´æˆ³å‚æ•°ï¼‰

### 3. URLå¯è¾¾æ€§æµ‹è¯•
```swift
private func testUrlReachability() {
    var request = URLRequest(url: url)
    request.httpMethod = "HEAD"
    request.timeoutInterval = 5.0
    // æµ‹è¯•ç½‘ç»œè¿æ¥æ€§
}
```

### 4. ç¼“å­˜å›é¿ç­–ç•¥
```swift
let urlString = "\(game.gameIconUrl)?v=\(forceRefresh)&t=\(Date().timeIntervalSince1970)"
```

## ğŸ¯ æ”¹è¿›ç‰¹æ€§

### è§†è§‰åé¦ˆå¢å¼º
- **åŠ è½½çŠ¶æ€**: æ˜¾ç¤º"åŠ è½½ä¸­"æ–‡å­— + è¿›åº¦æŒ‡ç¤ºå™¨
- **å¤±è´¥çŠ¶æ€**: çº¢è‰²æ¸å˜ + é‡è¯•è®¡æ•°å™¨
- **æˆåŠŸçŠ¶æ€**: æ˜¾ç¤ºçœŸå®Steamå›¾æ ‡

### äº¤äº’ä½“éªŒ
- **ç‚¹å‡»é‡è¯•**: å¤±è´¥çŠ¶æ€ä¸‹ç‚¹å‡»å›¾æ ‡å¯é‡è¯•
- **çŠ¶æ€æŒ‡ç¤º**: æ¸…æ™°çš„é‡è¯•æ¬¡æ•°æ˜¾ç¤º
- **é”™è¯¯æç¤º**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’ŒURLçŠ¶æ€

### è°ƒè¯•åŠŸèƒ½
- **è¯¦ç»†æ—¥å¿—**: æ¯ä¸ªåŠ è½½é˜¶æ®µçš„çŠ¶æ€è®°å½•
- **ç½‘ç»œæµ‹è¯•**: HEADè¯·æ±‚éªŒè¯URLå¯è¾¾æ€§
- **URLè·Ÿè¸ª**: è®°å½•ä½¿ç”¨çš„å®Œæ•´URLå‚æ•°

## ğŸ“Š é¢„æœŸæ•ˆæœ

### é—®é¢˜è§£å†³
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶é‡è¯•å¤±è´¥çš„å›¾æ ‡åŠ è½½
- âœ… æ¸…é™¤iOSç¼“å­˜å¯¼è‡´çš„æ˜¾ç¤ºé—®é¢˜
- âœ… æä¾›è¯¦ç»†çš„é—®é¢˜è¯Šæ–­ä¿¡æ¯
- âœ… å¢å¼ºç”¨æˆ·äº¤äº’ä½“éªŒ

### è°ƒè¯•ä¿¡æ¯
ç”¨æˆ·ç°åœ¨å¯ä»¥åœ¨Xcodeæ§åˆ¶å°çœ‹åˆ°ï¼š
```
ğŸ® DEBUG: TradingGameIconViewæ˜¾ç¤ºæ¸¸æˆ: Terraria
ğŸ”— DEBUG: ä½¿ç”¨å›¾æ ‡URL: https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/105600/capsule_231x87.jpg
ğŸ“± DEBUG: iconUrlå­—æ®µ: https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/105600/capsule_231x87.jpg
ğŸ”§ è®¾ç½®å›¾æ ‡URL: https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/105600/capsule_231x87.jpg?v=0
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### æµ‹è¯•æ­¥éª¤
1. è¿è¡ŒiOSåº”ç”¨
2. è¿›å…¥äº¤æ˜“ç•Œé¢
3. æŸ¥çœ‹Xcodeæ§åˆ¶å°çš„è°ƒè¯•è¾“å‡º
4. å¦‚æœå›¾æ ‡å¤±è´¥ï¼Œç‚¹å‡»å›¾æ ‡åŒºåŸŸé‡è¯•

### è°ƒè¯•ä¿¡æ¯è§£è¯»
- ğŸ® = ç»„ä»¶åˆå§‹åŒ–
- ğŸ”— = URLè®¾ç½®
- âœ… = æˆåŠŸåŠ è½½
- âŒ = åŠ è½½å¤±è´¥
- ğŸ”„ = é‡è¯•æ“ä½œ
- ğŸŒ = ç½‘ç»œå¯è¾¾æ€§æµ‹è¯•

è¿™æ¬¡ä¼˜åŒ–æ˜¾è‘—æå‡äº†å›¾æ ‡åŠ è½½çš„å¯é æ€§å’Œè°ƒè¯•èƒ½åŠ›ï¼Œä¸ºè§£å†³iOSæ¨¡æ‹Ÿå™¨ç½‘ç»œé—®é¢˜æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼ 