<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆå›¾æ ‡åŠ è½½æµ‹è¯• - GameStock</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-icon {
            border: 2px solid #ddd;
            margin: 10px;
            border-radius: 8px;
            transition: border-color 0.3s;
        }
        .test-icon.loading {
            border-color: #007bff;
        }
        .test-icon.success {
            border-color: #28a745;
        }
        .test-icon.error {
            border-color: #dc3545;
        }
        .test-card {
            margin-bottom: 20px;
        }
        .status-indicator {
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">ğŸ® GameStock å›¾æ ‡åŠ è½½æµ‹è¯•</h1>
        <p class="lead">åŸºäºSteamKitæ€è·¯çš„å¤šé‡åå¤‡å›¾æ ‡åŠ è½½ç­–ç•¥æµ‹è¯•</p>
        
        <div class="row" id="test-container">
            <!-- æµ‹è¯•ç”¨ä¾‹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="mt-4">
            <h3>æµ‹è¯•æ—¥å¿—</h3>
            <div id="test-log" class="border p-3" style="height: 300px; overflow-y: auto; background-color: #f8f9fa; font-family: monospace; font-size: 14px;"></div>
        </div>
    </div>

    <script>
        // æµ‹è¯•æ¸¸æˆæ•°æ®
        const testGames = [
            {
                steam_id: "730",
                name: "Counter-Strike 2",
                name_zh: "Counter-Strike 2",
                icon_url: "https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/730/capsule_231x87.jpg"
            },
            {
                steam_id: "2358720",
                name: "Black Myth: Wukong",
                name_zh: "é»‘ç¥è¯ï¼šæ‚Ÿç©º",
                icon_url: "https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/2358720/capsule_231x87.jpg"
            },
            {
                steam_id: "570",
                name: "Dota 2",
                name_zh: "Dota 2",
                icon_url: "https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/570/capsule_231x87.jpg"
            },
            {
                steam_id: "999999999",
                name: "Non-existent Game",
                name_zh: "ä¸å­˜åœ¨çš„æ¸¸æˆ",
                icon_url: "https://invalid-url.com/invalid.jpg"
            }
        ];

        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        // æ™ºèƒ½å›¾æ ‡åŠ è½½å‡½æ•° - ä¸dashboard.jsç›¸åŒ
        function loadGameIcon(imgElement, game, fallbackAttempt = 0) {
            const steamId = game.steam_id;
            const fallbackUrls = [
                game.icon_url || game.capsule_url,  // ä¸»è¦å›¾æ ‡URL
                `https://shared.cloudflare.steamstatic.com/store_item_assets/steam/apps/${steamId}/capsule_231x87.jpg`,  // èƒ¶å›Šå›¾
                `https://steamcdn-a.akamaihd.net/steam/apps/${steamId}/capsule_184x69.jpg`,  // å°èƒ¶å›Šå›¾
                `https://steamcdn-a.akamaihd.net/steam/apps/${steamId}/header.jpg`,  // å¤´å›¾
                '/static/images/game-placeholder.svg'  // æœ€ç»ˆå ä½ç¬¦
            ];
            
            if (fallbackAttempt < fallbackUrls.length - 1) {
                const currentUrl = fallbackUrls[fallbackAttempt];
                
                imgElement.className = 'test-icon loading';
                log(`ğŸ”„ å°è¯•åŠ è½½å›¾æ ‡ (ç¬¬${fallbackAttempt + 1}æ¬¡): ${game.name_zh || game.name} - ${currentUrl}`);
                
                // åˆ›å»ºæ–°å›¾ç‰‡å¯¹è±¡æµ‹è¯•URL
                const testImg = new Image();
                testImg.onload = function() {
                    imgElement.src = currentUrl;
                    imgElement.className = 'test-icon success';
                    if (fallbackAttempt > 0) {
                        log(`âœ… å›¾æ ‡åŠ è½½æˆåŠŸ (ç¬¬${fallbackAttempt + 1}æ¬¡å°è¯•): ${game.name_zh || game.name} - ${currentUrl}`);
                    } else {
                        log(`âœ… å›¾æ ‡åŠ è½½æˆåŠŸ: ${game.name_zh || game.name} - ${currentUrl}`);
                    }
                };
                testImg.onerror = function() {
                    log(`âŒ å›¾æ ‡åŠ è½½å¤±è´¥ (ç¬¬${fallbackAttempt + 1}æ¬¡å°è¯•): ${game.name_zh || game.name} - ${currentUrl}`);
                    loadGameIcon(imgElement, game, fallbackAttempt + 1);
                };
                testImg.src = currentUrl;
            } else {
                // æ‰€æœ‰URLéƒ½å¤±è´¥ï¼Œä½¿ç”¨SVGå ä½ç¬¦
                imgElement.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDIwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNGOEY5RkEiIHN0cm9rZT0iI0RFRTJFNiIgc3Ryb2tlLXdpZHRoPSIyIi8+PHRleHQgeD0iMTAwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjc4MyIgdGV4dC1hbmNob3I9Im1pZGRsZSI+R2FtZSBJY29uPC90ZXh0Pjwvc3ZnPg==';
                imgElement.className = 'test-icon error';
                log(`ğŸ”„ æ‰€æœ‰å›¾æ ‡URLå¤±è´¥ï¼Œä½¿ç”¨å ä½ç¬¦: ${game.name_zh || game.name}`);
            }
        }

        // ç”Ÿæˆæµ‹è¯•å¡ç‰‡
        function generateTestCards() {
            const container = document.getElementById('test-container');
            
            testGames.forEach((game, index) => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4';
                
                col.innerHTML = `
                    <div class="card test-card">
                        <div class="card-body text-center">
                            <h6 class="card-title">${game.name_zh || game.name}</h6>
                            <p class="text-muted">Steam ID: ${game.steam_id}</p>
                            <img id="test-img-${index}" 
                                 alt="${game.name}" 
                                 class="test-icon loading"
                                 style="width: 200px; height: 100px; object-fit: cover;">
                            <div class="status-indicator" id="status-${index}">
                                æ­£åœ¨åŠ è½½...
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(col);
            });
        }

        // å¼€å§‹æµ‹è¯•
        function startTest() {
            log('ğŸš€ å¼€å§‹GameStockå›¾æ ‡åŠ è½½æµ‹è¯•');
            log('ğŸ“‹ æµ‹è¯•ç­–ç•¥: å¤šé‡åå¤‡URLåŠ è½½');
            log('ğŸ”— åå¤‡URLé¡ºåº: 1.åŸå§‹URL â†’ 2.èƒ¶å›Šå›¾ â†’ 3.å°èƒ¶å›Šå›¾ â†’ 4.å¤´å›¾ â†’ 5.å ä½ç¬¦');
            log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
            
            testGames.forEach((game, index) => {
                const imgElement = document.getElementById(`test-img-${index}`);
                loadGameIcon(imgElement, game);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            generateTestCards();
            setTimeout(startTest, 500);
        });
    </script>
</body>
</html> 